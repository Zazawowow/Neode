version: '3.8'

services:
  # ATOB Service (Real container like in production)
  atob:
    image: nginx:alpine
    container_name: neode-atob
    hostname: atob
    volumes:
      - ./neode-ui/docker/atob-nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./neode-ui/docker/atob-html:/usr/share/nginx/html:ro
    ports:
      - "8101:80"
    restart: unless-stopped
    networks:
      - neode-dev
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:80"]
      interval: 10s
      timeout: 5s
      retries: 3

  # Mock Backend Service
  neode-backend:
    image: node:22-alpine
    container_name: neode-backend
    hostname: neode-backend
    working_dir: /app/neode-ui
    command:
      - sh
      - -c
      - |
        set -e
        echo "Installing dependencies..."
        npm install
        echo "Starting mock backend on port 5959..."
        node mock-backend.js
    volumes:
      - .:/app:cached
    ports:
      - "5959:5959"
    restart: unless-stopped
    networks:
      - neode-dev
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:5959/health"]
      interval: 15s
      timeout: 10s
      retries: 5
    environment:
      - NODE_ENV=development

  # Vue Dev Server (Vite with HMR)
  neode-vite:
    image: node:22-alpine
    container_name: neode-vite
    hostname: neode-vite
    working_dir: /app/neode-ui
    command:
      - sh
      - -c
      - |
        set -e
        echo "Installing dependencies..."
        npm install
        echo "Starting Vite dev server..."
        npm run dev -- --host 0.0.0.0
    volumes:
      - .:/app:cached
      - /app/neode-ui/node_modules
    ports:
      - "8100:8100"
    restart: unless-stopped
    depends_on:
      - neode-backend
      - atob
    networks:
      - neode-dev
    environment:
      - NODE_ENV=development
      - VITE_BACKEND_URL=http://neode-backend:5959
      - VITE_ATOB_URL=http://atob

networks:
  neode-dev:
    driver: bridge

